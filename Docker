# Use the official Miniconda3 image
FROM continuumio/miniconda3

# Set working directory inside the container
WORKDIR /app

# Copy environment.yml file to the container
COPY environment.yml .

# Create Conda environment
RUN conda env create -f environment.yml

# Set up Conda environment activation
SHELL ["conda", "run", "-n", "myenv", "/bin/bash", "-c"]

# Copy all project files into the container
COPY . .

# Activate environment and install additional dependencies if needed
RUN pip install --upgrade pip

# Expose port 8000 for the web application
EXPOSE 8000

# Run Django migrations (only if using Django)
RUN python manage.py migrate || true

# Start the web server (Flask or Django)
CMD ["gunicorn", "--bind", "0.0.0.0:8000", "app:app"]
